version: '3.8'

services:
  # Master MongoDB for the whole platform
  mongodb:
    image: mongo:latest
    container_name: legal-mongodb
    ports:
      - "27017:27017"
    volumes:
      - mongodb_data:/data/db
    restart: unless-stopped

  # Master AI Application (All-in-One)
  # This container runs Auth, Chatbot, Interact, and Agents Services
  legal-platform:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: legal-ai-platform-master
    ports:
      - "8000:8000" # Chatbot API
      - "8001:8001" # Interact API
      - "8002:8002" # Agents API
      - "8080:8080" # Auth Service
      - "8501:8501" # Interact Frontend
      - "8502:8502" # Chatbot Frontend
    environment:
      - MONGODB_URL=mongodb://mongodb:27017
      - APP_ENV=production
      # Secret keys should be moved to a secure .env file in production
      - JWT_SECRET_KEY=your-secret-key-change-in-production
      # API Keys for Cloud Services
      - GROQ_API_KEY=${GROQ_API_KEY}
      - QDRANT_URL=${QDRANT_URL}
      - QDRANT_API_KEY=${QDRANT_API_KEY}
    depends_on:
      - mongodb
    # Optional: Volume mount for documents folder if you want persistent local docs
    volumes:
      - ./ASK,DRAFT/Legal-Chatbot-Updated/documents:/app/ASK,DRAFT/Legal-Chatbot-Updated/documents
    restart: unless-stopped

volumes:
  mongodb_data:
